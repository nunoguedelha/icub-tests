<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>icub-test: Writing and Running Tests</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">icub-test
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Writing and Running Tests </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#writing-new-tests">Writing a new test</a></li>
<li class="level1"><a href="#running_single_test_case">Running a single test case</a></li>
<li class="level1"><a href="#running_multiple_tests">Running multiple tests using a test suite</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="writing-new-tests"></a>
Writing a new test</h1>
<p>Create a folder with the name of your test case in the <code>icub-tests/src/</code> folder to keep your test codes:</p>
<p>``` $ mkdir icub-tests/src/example-test ```</p>
<p>Create a child test class inherited from the <code>YarpTestCase</code>:</p>
<p>```c++ #ifndef <em>EXAMPLE_TEST_H</em> #define <em>EXAMPLE_TEST_H</em></p>
<p>#include &lt;YarpTestCase.h&gt;</p>
<p>class <a class="el" href="classExampleTest.html" title="This is just an example test, use it as a reference to implement new tests. ">ExampleTest</a> : public YarpTestCase { public: <a class="el" href="classExampleTest.html" title="This is just an example test, use it as a reference to implement new tests. ">ExampleTest()</a>; virtual ~ExampleTest();</p>
<p>virtual bool setup(yarp::os::Property&amp; property);</p>
<p>virtual void tearDown();</p>
<p>virtual void run(); };</p>
<p>#endif //_EXAMPLE_TEST_H ```</p>
<p>Implement the test case:</p>
<p>```c++ #include &lt;Plugin.h&gt; #include "ExampleTest.h"</p>
<p>using namespace std; using namespace RTF; using namespace yarp::os;</p>
<p>prepare the plugin PREPARE_PLUGIN(ExampleTest)</p>
<p>ExampleTest::ExampleTest() : YarpTestCase("ExampleTest") { }</p>
<p>ExampleTest::~ExampleTest() { }</p>
<p>bool ExampleTest::setup(yarp::os::Property &amp;property) {</p>
<p>initialization goes here ... updating the test name if(property.check("name")) setName(property.find("name").asString());</p>
<p>string example = property.check("example", Value("default value")).asString();</p>
<p>RTF_TEST_REPORT(Asserter::format("Use '%s' for the example param!", example.c_str())); return true; }</p>
<p>void ExampleTest::tearDown() { finalization goes here ... }</p>
<p>void ExampleTest::run() { </p>
<pre class="fragment">int a = 5; int b = 3;
RTF_TEST_REPORT("testing a &lt; b");
RTF_TEST_CHECK(a&lt;b, Asserter::format("%d is not smaller than %d.", a, b));
RTF_TEST_REPORT("testing a &gt; b");
RTF_TEST_CHECK(a&gt;b, Asserter::format("%d is not smaller than %d.", a, b));
RTF_TEST_REPORT("testing a == b");
RTF_TEST_CHECK(a==b, Asserter::format("%d is not smaller than %d.", a, b));
</pre><p> add more ... } ```</p>
<p>Notice: The <code>RTF_TEST_CHECK</code>, <code>RTF_TEST_REPORT</code> do NOT threw any exception and are used to add failure or report messages to the result collector. Instead, all the macros which include <code>_ASSERT_</code> within their names (e.g., <code>RTF_ASSERT_FAIL</code>) throw exceptions which prevent only the current test case (Not the whole test suite) of being proceed. The error/failure messages thrown by the exceptions are caught. (See <a href="http://robotology.github.io/robot-testing/documentation/TestAssert_8h.html">*Basic Assertion macros*</a>).</p>
<p>The report/assertion macros store the source line number where the check/report or assertion happen. To see them, you can run the test case or suit with <code>--detail</code> parameter using the <code>testrunner</code> (See <a href="http://robotology.github.io/robot-testing/documentation/testrunner.html">*Running test case plug-ins using testrunner*</a>).</p>
<p>Create a cmake file to build the plug-in:</p>
<p>```cmake cmake_minimum_required(VERSION 2.8.9)</p>
<h1>set the project name</h1>
<p>set(PROJECTNAME ExampleTest) project(${PROJECTNAME})</p>
<h1>add the required cmake packages</h1>
<p>find_package(RTF) find_package(RTF COMPONENTS DLL) find_package(YARP)</p>
<h1>add include directories</h1>
<p>include_directories(${CMAKE_SOURCE_DIR} ${RTF_INCLUDE_DIRS} ${YARP_INCLUDE_DIRS} ${YARP_HELPERS_INCLUDE_DIR})</p>
<h1>add required libraries</h1>
<p>link_libraries(${RTF_LIBRARIES} ${YARP_LIBRARIES})</p>
<h1>add the source codes to build the plugin library</h1>
<p>add_library(${PROJECTNAME} MODULE <a class="el" href="ExampleTest_8h_source.html">ExampleTest.h</a> <a class="el" href="ExampleTest_8cpp_source.html">ExampleTest.cpp</a>)</p>
<h1>set the installation options</h1>
<p>install(TARGETS ${PROJECTNAME} EXPORT ${PROJECTNAME} COMPONENT runtime LIBRARY DESTINATION lib) ```</p>
<p>Call your cmake file from the <code>icub-test/CMakeLists.txt</code> to build it along with the other other test plugins. To do that, adds the following line to the <code>icub-test/CMakeLists.txt</code></p>
<p>``` </p>
<h1>Build example test</h1>
<p>add_subdirectory(src/example-test) ```</p>
<p>Please check the <code>icub-tests/example</code> folder for a template for developing tests for the iCub.</p>
<h1><a class="anchor" id="running_single_test_case"></a>
Running a single test case</h1>
<p>As it is documented here (<a href="http://robotology.github.io/robot-testing/documentation/testrunner.html">*Running test case plug-ins using testrunner*</a>) you can run a single test case or run it with the other tests using a test suite. For example, to run a single test case:</p>
<p>``` testrunner &ndash;verbose &ndash;test plugins/ExampleTest.so &ndash;param "--name MyExampleTest" ```</p>
<p>Notice that this test require the <code>yarpserver</code> to be running and it contains tests that are programmed to succeed and some that are programmed to fail.</p>
<p>or to run the iCubSim camera test whith the test configuration file:</p>
<p>``` testrunner &ndash;verbose &ndash;test plugins/CameraTest.so &ndash;param "--from camera_right.ini" &ndash;environment "--robotname icubSim" ```</p>
<p>This runs the icubSim right-camera test with the parameters specified in the <code>right_camera.ini</code> which can be found in <code>icub-tests/suits/contexts/icubSim</code> folder. This test assumes you are running <code>yarpserver</code> and the iCub simulator (i.e. <code>iCub_SIM</code>).</p>
<p>Notice that the environment parameter <code>--robotname icubSim</code> is used to locate the correct context (for this examples is <code>icubSim</code>) and also to update the variables loaded from the <code>right_camera.ini</code> file.</p>
<h1><a class="anchor" id="running_multiple_tests"></a>
Running multiple tests using a test suite</h1>
<p>You can update one of the existing suite XML files to add your test case plug-in and its parameters or create a new test suite which keeps all the relevant test cases. For example the <code>basic-icubSim.xml</code> test suite keeps the basic tests for cameras and motors:</p>
<p>```xml &lt;?xml version="1.0" encoding="UTF-8"?&gt;</p>
<p>&lt;suit name="Basic Tests Suite"&gt; Testing robot's basic features &lt;environment&gt;&ndash;robotname icubSim&lt;/environment&gt; &lt;fixture param="--fixture icubsim-fixture.xml"&gt; yarpmanager &lt;/fixture&gt;</p>
<pre class="fragment">&lt;test type="dll" param="--from right_camera.ini"&gt; CameraTest &lt;/test&gt;
&lt;test type="dll" param="--from left_camera.ini"&gt; CameraTest &lt;/test&gt; 


&lt;test type="dll" param="--from test_right_arm.ini"&gt; MotorTest &lt;/test&gt;
&lt;test type="dll" param="--from test_left_arm.ini"&gt; MotorTest &lt;/test&gt;
</pre><p> &lt;/suit&gt;</p>
<p>```</p>
<p>Then you can run all the test cases from the test suite:</p>
<p>``` testrunner &ndash;verbose &ndash;suit icub-tests/suits/basics-icubSim.xml ```</p>
<p>The <code>testrunner</code>, first, launches the iCub simulator and then runs all the tests one after each other. After running all the test cases, the <code>tesrunner</code> stop the simulator. If the iCub simulator crashes during the test run, the <code>testrunner</code> re-launchs it and continues running the remaining tests.</p>
<p>How <code>testrunner</code> knows that it should launch the iCub simulator before running the tests? Well, this is indicated by <code>&lt;fixture param="--fixture icubsim-fixture.xml"&gt; yarpmanager &lt;/fixture&gt;</code>. The <code>testrunner</code> uses the <code>yarpmanager</code> fixture plug-in to launch the modules which are listed in the <code>icubsim-fixture.xml</code>. Notice that all the fixture files should be located in the <code>icub-tests/suits/fixtures</code> folder. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Dec 22 2015 14:16:54 for icub-test by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
